{
  "author": "",
  "category": "Network",
  "extensionNamespace": "",
  "fullName": "MatchMaking",
  "helpPath": "",
  "iconUrl": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0ibWRpLWRpc3RyaWJ1dGUtdmVydGljYWwtY2VudGVyIiB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZD0iTTIgMTZINVYxNEgxOVYxNkgyMlYxOEgxOVYyMEg1VjE4SDJWMTZNMiA4SDdWMTBIMTdWOEgyMlY2SDE3VjRIN1Y2SDJWOFoiIC8+PC9zdmc+",
  "name": "MatchMaking",
  "previewIconUrl": "https://asset-resources.gdevelop.io/public-resources/Icons/c684552a3de4345f9c1032221d770f932e084a4229efcad44ec110bb653d7eb3_distribute-vertical-center.svg",
  "shortDescription": "A simple matchmaking system with p2p and firebase-example.",
  "version": "1.2.1",
  "description": [
    "A simple matchmaking system with p2p and firebase-example",
    "",
    "```mermaid",
    "sequenceDiagram",
    "    participant firebase",
    "    host->>firebase: register as host in the pool",
    "    client->>firebase: finds a host from the pool",
    "    client->>host: connects to host",
    "    host->>client: checks for enough players",
    "    host->>firebase: remove itself from the pool",
    "    host->>client: sends client to next scene",
    "    host->>host: sends itself to next scene",
    "    client->>host: disconnect and restart scene on connection timeout",
    "    host->>host: subtracts client count upon client disconnection",
    "```"
  ],
  "tags": [
    "multiplayer",
    "firebase",
    "p2p",
    "peerjs",
    "matchmaking"
  ],
  "authorIds": [
    "rotBq28wITdtfsrE7McHQri4k2w2"
  ],
  "dependencies": [],
  "eventsFunctions": [
    {
      "description": "Set client scene variable.",
      "fullName": "Set client scene variable",
      "functionType": "Action",
      "group": "Shared Variable",
      "name": "SetClientVariable",
      "sentence": "Set client scene variable _PARAM1_",
      "events": [
        {
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": [
            "const SceneVariable = eventsFunctionContext.getArgument(\"SceneVariable\");",
            "gdjs.__MatchMaking.referenceVariable = SceneVariable;"
          ],
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "parameters": [
        {
          "description": "Everything you change to this variable will be changed to the server",
          "name": "SceneVariable",
          "type": "scenevar"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Set server scene variable.",
      "fullName": "Set server scene variable",
      "functionType": "Action",
      "group": "Shared Variable",
      "name": "SetServerVariable",
      "sentence": "Set server scene variable _PARAM1_",
      "events": [
        {
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": [
            "const SceneVariable = eventsFunctionContext.getArgument(\"SceneVariable\");",
            "gdjs.__MatchMaking.savedVariable = SceneVariable;"
          ],
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "parameters": [
        {
          "description": "Everything change from any connected clients will go to this variable",
          "name": "SceneVariable",
          "type": "scenevar"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Set host scene variable.",
      "fullName": "Set host scene variable",
      "functionType": "Action",
      "group": "Shared Variable",
      "name": "SetHostVariable",
      "sentence": "Set host scene variable _PARAM1_",
      "events": [
        {
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": [
            "const SceneVariable = eventsFunctionContext.getArgument(\"SceneVariable\");",
            "gdjs.__MatchMaking.hostVariable = SceneVariable;"
          ],
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        }
      ],
      "parameters": [
        {
          "description": "Everything change from host will go to this variable",
          "name": "SceneVariable",
          "type": "scenevar"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Shared Variable.",
      "fullName": "Shared Variable",
      "functionType": "StringExpression",
      "group": "Shared Variable",
      "name": "SharedVariable",
      "private": true,
      "sentence": "",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "SetReturnString"
              },
              "parameters": [
                "ToJSON(__MatchMaking.SharedVariable)"
              ]
            }
          ]
        }
      ],
      "expressionType": {
        "type": "string"
      },
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Handle Shared Variable.",
      "fullName": "Handle Shared Variable",
      "functionType": "Action",
      "name": "HandleSharedVariables",
      "private": true,
      "sentence": "Handle Shared Variable",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 109,
            "g": 230,
            "r": 255,
            "textB": 0,
            "textG": 0,
            "textR": 0
          },
          "comment": "Check if Variable is changed and update it",
          "comment2": ""
        },
        {
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": [
            "\r",
            "let UpdateString = \"\";\r",
            "\r",
            "if(gdjs.__MatchMaking.referenceVariable != undefined) {\r",
            "    UpdateString = JSON.stringify(gdjs.__MatchMaking.referenceVariable.toJSObject());\r",
            "}\r",
            "\r",
            "runtimeScene.getVariables().get(\"__MatchMaking\").getChild(\"Message\").setString(UpdateString);"
          ],
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        },
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 109,
            "g": 230,
            "r": 255,
            "textB": 0,
            "textG": 0,
            "textR": 0
          },
          "comment": "Send a message every 3 seconds to make sure everyone is still connected",
          "comment2": ""
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "BuiltinCommonInstructions::CompareNumbers"
              },
              "parameters": [
                "mod(Time(\"sec\"),3)",
                "=",
                "0"
              ]
            },
            {
              "type": {
                "value": "BuiltinCommonInstructions::Once"
              },
              "parameters": []
            }
          ],
          "actions": [
            {
              "type": {
                "value": "ModVarSceneTxt"
              },
              "parameters": [
                "__MatchMaking.LastSceneVariableState",
                "=",
                "\"\""
              ]
            }
          ]
        },
        {
          "folded": true,
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "BuiltinCommonInstructions::CompareStrings"
              },
              "parameters": [
                "VariableString(__MatchMaking.LastSceneVariableState)",
                "!=",
                "VariableString(__MatchMaking.Message)"
              ]
            }
          ],
          "actions": [
            {
              "type": {
                "value": "ModVarSceneTxt"
              },
              "parameters": [
                "__MatchMaking.LastSceneVariableState",
                "=",
                "VariableString(__MatchMaking.Message)"
              ]
            }
          ],
          "events": [
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "inverted": true,
                    "value": "MatchMaking::IsHost"
                  },
                  "parameters": [
                    "",
                    ""
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarSceneTxt"
                  },
                  "parameters": [
                    "__MatchMaking.TempData.sender",
                    "=",
                    "P2P::GetID()"
                  ]
                },
                {
                  "type": {
                    "value": "ModVarSceneTxt"
                  },
                  "parameters": [
                    "__MatchMaking.TempData.data",
                    "=",
                    "VariableString(__MatchMaking.Message)"
                  ]
                },
                {
                  "type": {
                    "value": "P2P::SendToOneVariable"
                  },
                  "parameters": [
                    "MatchMaking::HostId()",
                    "\"__MatchMaking.HostVariableShare\"",
                    "__MatchMaking.TempData"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "MatchMaking::IsHost"
                  },
                  "parameters": [
                    "",
                    ""
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarSceneTxt"
                  },
                  "parameters": [
                    "__MatchMaking.TempData.sender",
                    "=",
                    "P2P::GetID()"
                  ]
                },
                {
                  "type": {
                    "value": "ModVarSceneTxt"
                  },
                  "parameters": [
                    "__MatchMaking.TempData.data",
                    "=",
                    "VariableString(__MatchMaking.Message)"
                  ]
                },
                {
                  "type": {
                    "value": "P2P::SendToAllVariable"
                  },
                  "parameters": [
                    "\"__MatchMaking.ClientVariableShare\"",
                    "__MatchMaking.TempData"
                  ]
                }
              ],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarSceneTxt"
                      },
                      "parameters": [
                        "__MatchMaking._SharedVariable.Content",
                        "=",
                        "ToJSON(__MatchMaking.TempData)"
                      ]
                    },
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__MatchMaking._SharedVariable.Recieved",
                        "=",
                        "1"
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 109,
            "g": 230,
            "r": 255,
            "textB": 0,
            "textG": 0,
            "textR": 0
          },
          "comment": "Sending",
          "comment2": ""
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [],
          "events": [
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "MatchMaking::IsHost"
                  },
                  "parameters": [
                    "",
                    ""
                  ]
                },
                {
                  "type": {
                    "value": "P2P::OnEvent"
                  },
                  "parameters": [
                    "\"__MatchMaking.HostVariableShare\"",
                    "yes"
                  ]
                }
              ],
              "actions": [],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "P2P::SendToAll"
                      },
                      "parameters": [
                        "\"__MatchMaking.ClientVariableShare\"",
                        "P2P::GetEventData(\"__MatchMaking.HostVariableShare\")"
                      ]
                    }
                  ],
                  "events": [
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [],
                      "actions": [
                        {
                          "type": {
                            "value": "ModVarSceneTxt"
                          },
                          "parameters": [
                            "__MatchMaking._SharedVariable.Content",
                            "=",
                            "P2P::GetEventData(\"__MatchMaking.HostVariableShare\")"
                          ]
                        },
                        {
                          "type": {
                            "value": "ModVarScene"
                          },
                          "parameters": [
                            "__MatchMaking._SharedVariable.Recieved",
                            "=",
                            "1"
                          ]
                        },
                        {
                          "type": {
                            "value": "ModVarScene"
                          },
                          "parameters": [
                            "__MatchMaking._LastMessageRecievedTimeStamp",
                            "=",
                            "Time(\"timestamp\")"
                          ]
                        },
                        {
                          "type": {
                            "value": "ModVarScene"
                          },
                          "parameters": [
                            "__MatchMaking._MessageCount",
                            "+",
                            "1"
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "P2P::OnEvent"
                  },
                  "parameters": [
                    "\"__MatchMaking.ClientVariableShare\"",
                    "yes"
                  ]
                }
              ],
              "actions": [],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarSceneTxt"
                      },
                      "parameters": [
                        "__MatchMaking._SharedVariable.Content",
                        "=",
                        "P2P::GetEventData(\"__MatchMaking.ClientVariableShare\")"
                      ]
                    },
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__MatchMaking._SharedVariable.Recieved",
                        "=",
                        "1"
                      ]
                    },
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__MatchMaking._LastMessageRecievedTimeStamp",
                        "=",
                        "Time(\"timestamp\")"
                      ]
                    },
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__MatchMaking._MessageCount",
                        "+",
                        "1"
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 109,
            "g": 230,
            "r": 255,
            "textB": 0,
            "textG": 0,
            "textR": 0
          },
          "comment": "Recieving",
          "comment2": ""
        },
        {
          "folded": true,
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [],
          "events": [
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "VarScene"
                  },
                  "parameters": [
                    "__MatchMaking._SharedVariable.Recieved",
                    "=",
                    "1"
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__MatchMaking._SharedVariable.Recieved",
                    "=",
                    "0"
                  ]
                }
              ],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "DebuggerTools::ConsoleLog"
                      },
                      "parameters": [
                        "\"message recieve\"",
                        "",
                        ""
                      ]
                    },
                    {
                      "type": {
                        "value": "JSONToVariableStructure"
                      },
                      "parameters": [
                        "VariableString(__MatchMaking._SharedVariable.Content)",
                        "__MatchMaking.SharedContent"
                      ]
                    }
                  ]
                },
                {
                  "type": "BuiltinCommonInstructions::JsCode",
                  "inlineCode": [
                    "const MatchMaking = runtimeScene.getVariables().get(\"__MatchMaking\");",
                    "const SharedContent = MatchMaking.getChild('SharedContent').toJSObject();",
                    "const HostId = runtimeScene.getGame().getVariables().get(\"__MatchMaking\").getChild('HostId').getAsString();",
                    "",
                    "",
                    "if(SharedContent.data == 0) return;",
                    "if(SharedContent.data == \"\") return;",
                    "",
                    "MatchMaking.getChild('SharedVariable')",
                    "    .getChild(SharedContent.sender)",
                    "    .fromJSON(SharedContent.data);",
                    "",
                    "if(gdjs.__MatchMaking.savedVariable != undefined) {",
                    "    gdjs.__MatchMaking.savedVariable.fromJSObject(MatchMaking.getChild('SharedVariable').toJSObject());",
                    "}",
                    "",
                    "if(HostId == SharedContent.sender) {",
                    "    if(gdjs.__MatchMaking.hostVariable != undefined) {",
                    "        gdjs.__MatchMaking.hostVariable.fromJSON(SharedContent.data);",
                    "    }",
                    "}",
                    ""
                  ],
                  "parameterObjects": "",
                  "useStrict": true,
                  "eventsSheetExpanded": true
                }
              ]
            }
          ]
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Create Online Sprite Objects.",
      "fullName": "Create Online Sprite Objects ",
      "functionType": "Action",
      "name": "CreateOnlineObjects",
      "sentence": "Create Online Sprite Objects _PARAM1_",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "P2P::IsReady"
              },
              "parameters": []
            },
            {
              "type": {
                "value": "BuiltinCommonInstructions::Once"
              },
              "parameters": []
            }
          ],
          "actions": [],
          "events": [
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "MatchMaking::IsHost"
                  },
                  "parameters": [
                    "",
                    ""
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "MatchMaking::SendMessageToEveryone"
                  },
                  "parameters": [
                    "",
                    "GlobalVarToJSON(__MatchMaking.Players)",
                    ""
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "MatchMaking::IsMessageRecieved"
              },
              "parameters": [
                "",
                ""
              ]
            }
          ],
          "actions": [],
          "events": [
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "JSONToVariableStructure"
                  },
                  "parameters": [
                    "MatchMaking::RecievedMessageChannel1()",
                    "Players"
                  ]
                }
              ],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::ForEachChildVariable",
                  "iterableVariableName": "Players",
                  "valueIteratorVariableName": "child",
                  "keyIteratorVariableName": "index",
                  "conditions": [],
                  "actions": [],
                  "events": [
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [],
                      "actions": [
                        {
                          "type": {
                            "value": "Create"
                          },
                          "parameters": [
                            "",
                            "SpaceMan",
                            "CameraCenterX()",
                            "CameraCenterY()",
                            ""
                          ]
                        },
                        {
                          "type": {
                            "value": "MatchMaking::OnlineSprite::SetID"
                          },
                          "parameters": [
                            "SpaceMan",
                            "OnlineSprite",
                            "VariableString(child)",
                            ""
                          ]
                        },
                        {
                          "type": {
                            "value": "ModVarObjetTxt"
                          },
                          "parameters": [
                            "SpaceMan",
                            "coordinates.id",
                            "=",
                            "VariableString(child)"
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "parameters": [
        {
          "description": "Online Sprite",
          "name": "SpaceMan",
          "supplementaryInformation": "Sprite",
          "type": "objectList"
        },
        {
          "description": "Online Sprite Behavior",
          "name": "OnlineSprite",
          "supplementaryInformation": "MatchMaking::OnlineSprite",
          "type": "behavior"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Send Message To Everyone Channel 1.",
      "fullName": "Send Message To Everyone Channel 1",
      "functionType": "Action",
      "name": "SendMessageToEveryone",
      "private": true,
      "sentence": "Send String _PARAM1_ To Everyone Channel 1",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "P2P::SendToAll"
              },
              "parameters": [
                "\"__MatchMaking.PlayersData\"",
                "GetArgumentAsString(\"Message\")"
              ]
            },
            {
              "type": {
                "value": "ModVarSceneTxt"
              },
              "parameters": [
                "__MatchMaking.RecievedData",
                "=",
                "GetArgumentAsString(\"Message\")"
              ]
            },
            {
              "type": {
                "value": "SetSceneVariableAsBoolean"
              },
              "parameters": [
                "__MatchMaking.DataRecieved",
                "True"
              ]
            }
          ]
        }
      ],
      "parameters": [
        {
          "description": "Message String",
          "name": "Message",
          "type": "string"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Send Message To Everyone Channel 2.",
      "fullName": "Send Message To Everyone Channel 2",
      "functionType": "Action",
      "name": "SendMessageToEveryone2",
      "private": true,
      "sentence": "Send Message _PARAM1_ To Everyone Channel 2",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "BuiltinCommonInstructions::CompareStrings"
              },
              "parameters": [
                "VariableString(__MatchMaking.LastState)",
                "!=",
                "GetArgumentAsString(\"Message\")"
              ]
            }
          ],
          "actions": [
            {
              "type": {
                "value": "ModVarSceneTxt"
              },
              "parameters": [
                "__MatchMaking.LastState",
                "=",
                "GetArgumentAsString(\"Message\")"
              ]
            }
          ],
          "events": [
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "inverted": true,
                    "value": "MatchMaking::IsHost"
                  },
                  "parameters": [
                    "",
                    ""
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "P2P::SendToOne"
                  },
                  "parameters": [
                    "MatchMaking::HostId()",
                    "\"__MatchMaking.HostMovement\"",
                    "GetArgumentAsString(\"Message\")"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "MatchMaking::IsHost"
                  },
                  "parameters": [
                    "",
                    ""
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "P2P::SendToAll"
                  },
                  "parameters": [
                    "\"__MatchMaking.ClientMovement\"",
                    "GetArgumentAsString(\"Message\")"
                  ]
                }
              ]
            }
          ]
        }
      ],
      "parameters": [
        {
          "description": "Message",
          "name": "Message",
          "supplementaryInformation": "Sprite",
          "type": "string"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Message is Recieved Channel 1.",
      "fullName": "Message is Recieved Channel 1",
      "functionType": "Condition",
      "name": "IsMessageRecieved",
      "private": true,
      "sentence": "Message is Recieved Channel 1",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "SceneVariableAsBoolean"
              },
              "parameters": [
                "__MatchMaking.DataRecieved",
                "True"
              ]
            }
          ],
          "actions": [
            {
              "type": {
                "value": "SetReturnBoolean"
              },
              "parameters": [
                "True"
              ]
            }
          ]
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Message is Recieved Channel 2.",
      "fullName": "Message is Recieved Channel 2",
      "functionType": "Condition",
      "name": "IsMessageRecieved2",
      "private": true,
      "sentence": "Message is Recieved Channel 2",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "VarScene"
              },
              "parameters": [
                "__MatchMaking._Message.Recieved",
                "=",
                "1"
              ]
            }
          ],
          "actions": [
            {
              "type": {
                "value": "SetReturnBoolean"
              },
              "parameters": [
                "True"
              ]
            }
          ]
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Recieved Message String.",
      "fullName": "Recieved Message String",
      "functionType": "StringExpression",
      "name": "RecievedMessageChannel1",
      "private": true,
      "sentence": "Message is Recieved",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "SetSceneVariableAsBoolean"
              },
              "parameters": [
                "__MatchMaking.DataRecieved",
                ""
              ]
            },
            {
              "type": {
                "value": "SetReturnString"
              },
              "parameters": [
                "VariableString(__MatchMaking.RecievedData)"
              ]
            }
          ]
        }
      ],
      "expressionType": {
        "type": "string"
      },
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Recieved Message String.",
      "fullName": "Recieved Message String",
      "functionType": "StringExpression",
      "name": "RecievedMessageChannel2",
      "private": true,
      "sentence": "Message is Recieved",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "SetReturnString"
              },
              "parameters": [
                "VariableString(__MatchMaking._Message.Content)"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__MatchMaking._Message.Recieved",
                "=",
                "0"
              ]
            }
          ]
        }
      ],
      "expressionType": {
        "type": "string"
      },
      "parameters": [],
      "objectGroups": []
    },
    {
      "fullName": "",
      "functionType": "Action",
      "name": "onSceneLoaded",
      "sentence": "",
      "events": [
        {
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": "gdjs.__MatchMaking = {};",
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": false
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "inverted": true,
                "value": "Firebase::IsSignedIn"
              },
              "parameters": []
            }
          ],
          "actions": [
            {
              "type": {
                "value": "Firebase::AnonymousSignIn"
              },
              "parameters": [
                "error"
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "P2P::UseDefaultBroker"
              },
              "parameters": []
            }
          ]
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Match making for a number of players then change scenes.",
      "fullName": "Match making for a number of players then change scenes",
      "functionType": "Action",
      "group": "MatchMaker",
      "name": "MatchMakingFeatureWithChangeScene",
      "sentence": "Match making for _PARAM1_ players , change scenes (host: _PARAM3_ ), (client: _PARAM4_ ) after matching",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__MatchMaking.PlayersToMatch",
                "=",
                "GetArgumentAsNumber(\"NumberOfPlayersToMatch\")-1"
              ]
            },
            {
              "type": {
                "value": "ModVarGlobal"
              },
              "parameters": [
                "__MatchMaking.IsHost",
                "=",
                "0"
              ]
            },
            {
              "type": {
                "value": "ModVarGlobal"
              },
              "parameters": [
                "__MatchMaking.PlayersCount",
                "=",
                "GetArgumentAsNumber(\"NumberOfPlayersToMatch\")"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__MatchMaking.Enable",
                "=",
                "1"
              ]
            },
            {
              "type": {
                "value": "ModVarSceneTxt"
              },
              "parameters": [
                "__MatchMaking.FirebasePath",
                "=",
                "GetArgumentAsString(\"FireBasePath\")"
              ]
            },
            {
              "type": {
                "value": "ModVarSceneTxt"
              },
              "parameters": [
                "__MatchMaking.ChangeScene.Host",
                "=",
                "GetArgumentAsString(\"HostSceneChange\")"
              ]
            },
            {
              "type": {
                "value": "ModVarSceneTxt"
              },
              "parameters": [
                "__MatchMaking.ChangeScene.Client",
                "=",
                "GetArgumentAsString(\"ClientSceneChange\")"
              ]
            },
            {
              "type": {
                "value": "SetSceneVariableAsBoolean"
              },
              "parameters": [
                "__MatchMaking.ChangeScene.Enable",
                "="
              ]
            },
            {
              "type": {
                "value": "SetSceneVariableAsBoolean"
              },
              "parameters": [
                "__MatchMaking.DisableChangeScene",
                "False"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__MatchMaking.MatchMakingResult",
                "=",
                "0"
              ]
            },
            {
              "type": {
                "value": "GlobalVariableClearChildren"
              },
              "parameters": [
                "__MatchMaking.Players"
              ]
            }
          ]
        }
      ],
      "parameters": [
        {
          "description": "Number of players to match before starting (minimum of 2 players)",
          "name": "NumberOfPlayersToMatch",
          "type": "expression"
        },
        {
          "description": "firebase realtime database path to store lobby data (e.g. /lobby/waiting)",
          "name": "FireBasePath",
          "type": "string"
        },
        {
          "description": "Change host scene after all matching players are connected",
          "name": "HostSceneChange",
          "type": "sceneName"
        },
        {
          "description": "Change client scene after it connected to a host",
          "name": "ClientSceneChange",
          "type": "sceneName"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Match making for a number of players without changing scenes.",
      "fullName": "Match making for a number of players without changing scenes",
      "functionType": "Action",
      "group": "MatchMaker",
      "name": "MatchMakingFeatureWithoutChangeScene",
      "sentence": "Match making for _PARAM1_ players without changing scenes",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__MatchMaking.PlayersToMatch",
                "=",
                "GetArgumentAsNumber(\"NumberOfPlayersToMatch\")-1"
              ]
            },
            {
              "type": {
                "value": "ModVarGlobal"
              },
              "parameters": [
                "__MatchMaking.IsHost",
                "=",
                "0"
              ]
            },
            {
              "type": {
                "value": "ModVarGlobal"
              },
              "parameters": [
                "__MatchMaking.PlayersCount",
                "=",
                "GetArgumentAsNumber(\"NumberOfPlayersToMatch\")"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__MatchMaking.Enable",
                "=",
                "1"
              ]
            },
            {
              "type": {
                "value": "ModVarSceneTxt"
              },
              "parameters": [
                "__MatchMaking.FirebasePath",
                "=",
                "GetArgumentAsString(\"FireBasePath\")"
              ]
            },
            {
              "type": {
                "value": "ModVarSceneTxt"
              },
              "parameters": [
                "__MatchMaking.ChangeScene.Host",
                "=",
                "GetArgumentAsString(\"HostSceneChange\")"
              ]
            },
            {
              "type": {
                "value": "ModVarSceneTxt"
              },
              "parameters": [
                "__MatchMaking.ChangeScene.Client",
                "=",
                "GetArgumentAsString(\"ClientSceneChange\")"
              ]
            },
            {
              "type": {
                "value": "SetSceneVariableAsBoolean"
              },
              "parameters": [
                "__MatchMaking.ChangeScene.Enable",
                "="
              ]
            },
            {
              "type": {
                "value": "SetSceneVariableAsBoolean"
              },
              "parameters": [
                "__MatchMaking.DisableChangeScene",
                "True"
              ]
            },
            {
              "type": {
                "value": "ModVarScene"
              },
              "parameters": [
                "__MatchMaking.MatchMakingResult",
                "=",
                "0"
              ]
            },
            {
              "type": {
                "value": "GlobalVariableClearChildren"
              },
              "parameters": [
                "__MatchMaking.Players"
              ]
            }
          ]
        }
      ],
      "parameters": [
        {
          "description": "Number of players to match before starting (minimum of 2 players)",
          "name": "NumberOfPlayersToMatch",
          "type": "expression"
        },
        {
          "description": "firebase realtime database path to store lobby data (e.g. /lobby/waiting)",
          "name": "FireBasePath",
          "type": "string"
        }
      ],
      "objectGroups": []
    },
    {
      "fullName": "",
      "functionType": "Action",
      "name": "onScenePreEvents",
      "sentence": "",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "VarScene"
              },
              "parameters": [
                "__MatchMaking.Enable",
                "=",
                "1"
              ]
            }
          ],
          "actions": [
            {
              "type": {
                "value": "MatchMaking::MatchMakingPreEvents"
              },
              "parameters": [
                "",
                ""
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "P2P::OnEvent"
              },
              "parameters": [
                "\"__MatchMaking.PlayersData\"",
                ""
              ]
            }
          ],
          "actions": [
            {
              "type": {
                "value": "SetSceneVariableAsBoolean"
              },
              "parameters": [
                "__MatchMaking.DataRecieved",
                "True"
              ]
            },
            {
              "type": {
                "value": "ModVarSceneTxt"
              },
              "parameters": [
                "__MatchMaking.RecievedData",
                "=",
                "P2P::GetEventData(\"__MatchMaking.PlayersData\")"
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 109,
            "g": 230,
            "r": 255,
            "textB": 0,
            "textG": 0,
            "textR": 0
          },
          "comment": "Propagate message to all clients",
          "comment2": ""
        },
        {
          "folded": true,
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [],
          "events": [
            {
              "folded": true,
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "MatchMaking::IsHost"
                  },
                  "parameters": [
                    "",
                    ""
                  ]
                },
                {
                  "type": {
                    "value": "P2P::OnEvent"
                  },
                  "parameters": [
                    "\"__MatchMaking.HostMovement\"",
                    "yes"
                  ]
                }
              ],
              "actions": [],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "P2P::SendToAll"
                      },
                      "parameters": [
                        "\"__MatchMaking.ClientMovement\"",
                        "P2P::GetEventData(\"__MatchMaking.HostMovement\")"
                      ]
                    }
                  ],
                  "events": [
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [],
                      "actions": [
                        {
                          "type": {
                            "value": "ModVarSceneTxt"
                          },
                          "parameters": [
                            "__MatchMaking._Message.Content",
                            "=",
                            "P2P::GetEventData(\"__MatchMaking.HostMovement\")"
                          ]
                        },
                        {
                          "type": {
                            "value": "ModVarScene"
                          },
                          "parameters": [
                            "__MatchMaking._Message.Recieved",
                            "=",
                            "1"
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "folded": true,
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "P2P::OnEvent"
                  },
                  "parameters": [
                    "\"__MatchMaking.ClientMovement\"",
                    "yes"
                  ]
                }
              ],
              "actions": [],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarSceneTxt"
                      },
                      "parameters": [
                        "__MatchMaking._Message.Content",
                        "=",
                        "P2P::GetEventData(\"__MatchMaking.ClientMovement\")"
                      ]
                    },
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__MatchMaking._Message.Recieved",
                        "=",
                        "1"
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 109,
            "g": 230,
            "r": 255,
            "textB": 0,
            "textG": 0,
            "textR": 0
          },
          "comment": "Propagate variables to all clients",
          "comment2": ""
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "MatchMaking::HandleSharedVariables"
              },
              "parameters": [
                "",
                ""
              ]
            }
          ]
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Get a variable from the database and bind it in a Scene Variable (this means every server data change this variable will also be updated).",
      "fullName": "Get and bind variable from the database",
      "functionType": "Action",
      "group": "MatchMaker",
      "name": "BindDatabaseVariable",
      "private": true,
      "sentence": "Bind database variable _PARAM1_ into _PARAM2_ (store result state in _PARAM3_)",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": []
        },
        {
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": [
            "const Path = eventsFunctionContext.getArgument(\"Path\")",
            "const StoreData = eventsFunctionContext.getArgument(\"StoreData\");",
            "const ErrorData = eventsFunctionContext.getArgument(\"ErrorData\");",
            "var Reference = firebase.database().ref().child(Path);",
            "",
            "// Check if child is accessible first then listen",
            "Reference.get().then((snapshot) => {",
            "    Reference.on('value', function (snapshot){",
            "        StoreData.fromJSObject(snapshot.val());",
            "    });",
            "    ErrorData.setString(\"ok\");",
            "}).catch((error) => {",
            "    ErrorData.setString(\"error\");",
            "});",
            ""
          ],
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [
        {
          "description": "Path",
          "name": "Path",
          "type": "string"
        },
        {
          "description": "Callback variable where to store the data",
          "name": "StoreData",
          "type": "scenevar"
        },
        {
          "description": "Callback variable with state (ok or error)",
          "name": "ErrorData",
          "type": "scenevar"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Activate online presence to a realtime database.",
      "fullName": "Activate online presence to a realtime database",
      "functionType": "Action",
      "group": "MatchMaker",
      "name": "BindOnlinePresence",
      "private": true,
      "sentence": "Activate online presence to a realtime database variable _PARAM1_ ( and send extra data _PARAM2_ )",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": []
        },
        {
          "type": "BuiltinCommonInstructions::JsCode",
          "inlineCode": [
            "const Path = eventsFunctionContext.getArgument(\"Path\")",
            "const ExtraData = eventsFunctionContext.getArgument(\"ExtraData\");",
            "",
            "// Fetch the current user's ID from Firebase Authentication.",
            "var uid = firebase.auth().currentUser.uid;",
            "",
            "// Create a reference to this user's specific status node.",
            "// This is where we will store data about being online/offline.",
            "var userStatusDatabaseRef = firebase.database().ref(Path + '/' + uid);",
            "",
            "// We'll create two constants which we will write to ",
            "// the Realtime database when this device is offline",
            "// or online.",
            "var isOfflineForDatabase = {",
            "    state: 'offline',",
            "    last_changed: firebase.database.ServerValue.TIMESTAMP,",
            "    extraData: ExtraData,",
            "};",
            "",
            "var isOnlineForDatabase = {",
            "    state: 'online',",
            "    last_changed: firebase.database.ServerValue.TIMESTAMP,",
            "    extraData: ExtraData,",
            "};",
            "",
            "// Create a reference to the special '.info/connected' path in ",
            "// Realtime Database. This path returns `true` when connected",
            "// and `false` when disconnected.",
            "firebase.database().ref('.info/connected').on('value', function(snapshot) {",
            "    // If we're not currently connected, don't do anything.",
            "    if (snapshot.val() == false) {",
            "        return;",
            "    };",
            "",
            "    // // Set status to offline when disconnected",
            "    // userStatusDatabaseRef.onDisconnect().set(isOfflineForDatabase).then(function() {",
            "    //     userStatusDatabaseRef.set(isOnlineForDatabase);",
            "    // });",
            "",
            "    // Delete row of data when disconnected",
            "    userStatusDatabaseRef.onDisconnect().remove(()=>{}).then(function() {",
            "        userStatusDatabaseRef.set(isOnlineForDatabase);",
            "    });",
            "",
            "",
            "});"
          ],
          "parameterObjects": "",
          "useStrict": true,
          "eventsSheetExpanded": true
        }
      ],
      "parameters": [
        {
          "description": "Path",
          "name": "Path",
          "type": "string"
        },
        {
          "description": "ExtraData you want to send along with the presence",
          "name": "ExtraData",
          "type": "string"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Display the data of matchmaking in json text.",
      "fullName": "Display the data of matchmaking in json text",
      "functionType": "StringExpression",
      "name": "Data",
      "private": true,
      "sentence": "",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "SetReturnString"
              },
              "parameters": [
                "ToJSON(__MatchMaking.data)"
              ]
            }
          ]
        }
      ],
      "expressionType": {
        "type": "string"
      },
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Display the status of matchmaking.",
      "fullName": "Display the status of matchmaking",
      "functionType": "StringExpression",
      "name": "Status",
      "private": true,
      "sentence": "",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "SetReturnString"
              },
              "parameters": [
                "ToJSON(__MatchMaking.error)"
              ]
            }
          ]
        }
      ],
      "expressionType": {
        "type": "string"
      },
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Check if the matched player is host.",
      "fullName": "Check if the matched player is host",
      "functionType": "Condition",
      "name": "IsHost",
      "sentence": "Is the matched player host?",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "VarGlobal"
              },
              "parameters": [
                "__MatchMaking.IsHost",
                "=",
                "1"
              ]
            }
          ],
          "actions": [
            {
              "type": {
                "value": "SetReturnBoolean"
              },
              "parameters": [
                "True"
              ]
            }
          ]
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Get the number of players that are waiting.",
      "fullName": "Get the number of players that are waiting",
      "functionType": "Expression",
      "name": "WaitingPlayersCount",
      "sentence": "",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "SetReturnNumber"
              },
              "parameters": [
                "VariableChildCount(__MatchMaking.data)"
              ]
            }
          ]
        }
      ],
      "expressionType": {
        "type": "expression"
      },
      "parameters": [],
      "objectGroups": []
    },
    {
      "fullName": "",
      "functionType": "Expression",
      "name": "PlayersCount",
      "private": true,
      "sentence": "",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "SetReturnNumber"
              },
              "parameters": [
                "GlobalVariable(__MatchMaking.PlayersCount)"
              ]
            }
          ]
        }
      ],
      "expressionType": {
        "type": "expression"
      },
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Get Host ID.",
      "fullName": "Get Host ID",
      "functionType": "StringExpression",
      "name": "HostId",
      "private": true,
      "sentence": "",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "SetReturnString"
              },
              "parameters": [
                "GlobalVariableString(__MatchMaking.HostId)"
              ]
            }
          ]
        }
      ],
      "expressionType": {
        "type": "string"
      },
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Update all sprite positions.",
      "fullName": "Update all sprite positions",
      "functionType": "Action",
      "name": "UpdateAllInstanceOfSprite",
      "sentence": "Update all _PARAM1_ sprite positions",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "MatchMaking::IsMessageRecieved2"
              },
              "parameters": [
                "",
                ""
              ]
            }
          ],
          "actions": [],
          "events": [
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "MatchMaking::OnlineSprite::UpdateSprite"
                  },
                  "parameters": [
                    "Object",
                    "Behavior",
                    "MatchMaking::RecievedMessageChannel2()",
                    ""
                  ]
                }
              ]
            }
          ]
        }
      ],
      "parameters": [
        {
          "description": "Object",
          "name": "Object",
          "supplementaryInformation": "Sprite",
          "type": "objectList"
        },
        {
          "description": "Behavior",
          "name": "Behavior",
          "supplementaryInformation": "MatchMaking::OnlineSprite",
          "type": "behavior"
        }
      ],
      "objectGroups": []
    },
    {
      "description": "Match making events per frame.",
      "fullName": "Match making events per frame",
      "functionType": "Action",
      "name": "MatchMakingPreEvents",
      "private": true,
      "sentence": "Match making events per frame",
      "events": [
        {
          "colorB": 228,
          "colorG": 176,
          "colorR": 74,
          "creationTime": 0,
          "name": "Matchmaking for N players",
          "source": "",
          "type": "BuiltinCommonInstructions::Group",
          "events": [
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 109,
                "g": 230,
                "r": 255,
                "textB": 0,
                "textG": 0,
                "textR": 0
              },
              "comment": "Wait until everything is ready",
              "comment2": ""
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "Firebase::IsSignedIn"
                  },
                  "parameters": []
                },
                {
                  "type": {
                    "value": "BuiltinCommonInstructions::CompareStrings"
                  },
                  "parameters": [
                    "P2P::GetID()",
                    "!=",
                    "\"\""
                  ]
                }
              ],
              "actions": [],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "BuiltinCommonInstructions::Once"
                      },
                      "parameters": []
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "MatchMaking::BindDatabaseVariable"
                      },
                      "parameters": [
                        "",
                        "VariableString(__MatchMaking.FirebasePath)",
                        "__MatchMaking.data",
                        "__MatchMaking.error",
                        ""
                      ]
                    }
                  ]
                },
                {
                  "type": "BuiltinCommonInstructions::Comment",
                  "color": {
                    "b": 109,
                    "g": 230,
                    "r": 255,
                    "textB": 0,
                    "textG": 0,
                    "textR": 0
                  },
                  "comment": "Listen to server changes",
                  "comment2": ""
                },
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "BuiltinCommonInstructions::Once"
                      },
                      "parameters": []
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "MatchMaking::BindOnlinePresence"
                      },
                      "parameters": [
                        "",
                        "VariableString(__MatchMaking.FirebasePath)",
                        "P2P::GetID()",
                        ""
                      ]
                    }
                  ]
                },
                {
                  "type": "BuiltinCommonInstructions::Comment",
                  "color": {
                    "b": 109,
                    "g": 230,
                    "r": 255,
                    "textB": 0,
                    "textG": 0,
                    "textR": 0
                  },
                  "comment": "Wait till server send data",
                  "comment2": ""
                },
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "BuiltinCommonInstructions::CompareStrings"
                      },
                      "parameters": [
                        "ToJSON(__MatchMaking.data)",
                        "!=",
                        "\"0\""
                      ]
                    },
                    {
                      "type": {
                        "value": "BuiltinCommonInstructions::Once"
                      },
                      "parameters": []
                    }
                  ],
                  "actions": [],
                  "events": [
                    {
                      "type": "BuiltinCommonInstructions::Comment",
                      "color": {
                        "b": 109,
                        "g": 230,
                        "r": 255,
                        "textB": 0,
                        "textG": 0,
                        "textR": 0
                      },
                      "comment": "Attempt to connect to users that are listed",
                      "comment2": ""
                    },
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [],
                      "actions": [
                        {
                          "type": {
                            "value": "SetSceneVariableAsBoolean"
                          },
                          "parameters": [
                            "__MatchMaking.Connecting",
                            "False"
                          ]
                        }
                      ],
                      "events": [
                        {
                          "type": "BuiltinCommonInstructions::ForEachChildVariable",
                          "iterableVariableName": "__MatchMaking.data",
                          "valueIteratorVariableName": "__MatchMaking.child",
                          "keyIteratorVariableName": "__MatchMaking.uid",
                          "conditions": [],
                          "actions": [],
                          "events": [
                            {
                              "type": "BuiltinCommonInstructions::Standard",
                              "conditions": [
                                {
                                  "type": {
                                    "value": "VarSceneTxt"
                                  },
                                  "parameters": [
                                    "__MatchMaking.uid",
                                    "!=",
                                    "Firebase::GetUserUID()"
                                  ]
                                },
                                {
                                  "type": {
                                    "value": "SceneVariableAsBoolean"
                                  },
                                  "parameters": [
                                    "__MatchMaking.Connecting",
                                    "False"
                                  ]
                                }
                              ],
                              "actions": [
                                {
                                  "type": {
                                    "value": "SetSceneVariableAsBoolean"
                                  },
                                  "parameters": [
                                    "__MatchMaking.Connecting",
                                    "True"
                                  ]
                                },
                                {
                                  "type": {
                                    "value": "ModVarScene"
                                  },
                                  "parameters": [
                                    "__MatchMaking.Connection.attempts",
                                    "=",
                                    "5"
                                  ]
                                },
                                {
                                  "type": {
                                    "value": "ModVarSceneTxt"
                                  },
                                  "parameters": [
                                    "__MatchMaking.Connection.p2pId",
                                    "=",
                                    "VariableString(__MatchMaking.child.extraData)"
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 109,
                "g": 230,
                "r": 255,
                "textB": 0,
                "textG": 0,
                "textR": 0
              },
              "comment": "If a player connected to you unlist yourself",
              "comment2": ""
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "P2P::OnConnection"
                  },
                  "parameters": []
                }
              ],
              "actions": [],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "P2P::SendToAll"
                      },
                      "parameters": [
                        "\"__MatchMaking.connected\"",
                        "\"\""
                      ]
                    },
                    {
                      "type": {
                        "value": "GlobalVariablePushString"
                      },
                      "parameters": [
                        "__MatchMaking.Players",
                        "P2P::GetLastConnectedPeer()"
                      ]
                    },
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__MatchMaking.MatchMakingResult",
                        "=",
                        "5"
                      ]
                    }
                  ],
                  "events": [
                    {
                      "type": "BuiltinCommonInstructions::JsCode",
                      "inlineCode": [
                        "// Only count unique players    ",
                        "let unique = (a,t={}) => a.filter(e=>!(t[e]=e in t));",
                        "",
                        "const PlayersGlobal = runtimeScene.getGame().getVariables().get(\"__MatchMaking\").getChild(\"Players\");",
                        "PlayersGlobal.fromJSObject(unique(PlayersGlobal.toJSObject()))"
                      ],
                      "parameterObjects": "",
                      "useStrict": true,
                      "eventsSheetExpanded": false
                    },
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [
                        {
                          "type": {
                            "value": "VarScene"
                          },
                          "parameters": [
                            "__MatchMaking.PlayersToMatch",
                            "=",
                            "GlobalVariableChildCount(__MatchMaking.Players)"
                          ]
                        }
                      ],
                      "actions": [
                        {
                          "type": {
                            "value": "P2P::SendToAll"
                          },
                          "parameters": [
                            "\"__MatchMaking.waitingForHost\"",
                            "\"\""
                          ]
                        },
                        {
                          "type": {
                            "value": "ModVarGlobal"
                          },
                          "parameters": [
                            "__MatchMaking.IsHost",
                            "=",
                            "1"
                          ]
                        },
                        {
                          "type": {
                            "value": "Firebase::DatabaseDeleteField"
                          },
                          "parameters": [
                            "VariableString(__MatchMaking.FirebasePath)",
                            "Firebase::GetUserUID()",
                            "__MatchMaking.error"
                          ]
                        },
                        {
                          "type": {
                            "value": "GlobalVariablePushString"
                          },
                          "parameters": [
                            "__MatchMaking.Players",
                            "P2P::GetID()"
                          ]
                        },
                        {
                          "type": {
                            "value": "ModVarGlobalTxt"
                          },
                          "parameters": [
                            "__MatchMaking.HostId",
                            "=",
                            "P2P::GetID()"
                          ]
                        }
                      ],
                      "events": [
                        {
                          "type": "BuiltinCommonInstructions::Standard",
                          "conditions": [],
                          "actions": [
                            {
                              "type": {
                                "value": "ModVarScene"
                              },
                              "parameters": [
                                "__MatchMaking.MatchMakingResult",
                                "=",
                                "4"
                              ]
                            }
                          ]
                        },
                        {
                          "type": "BuiltinCommonInstructions::Standard",
                          "conditions": [
                            {
                              "type": {
                                "value": "SceneVariableAsBoolean"
                              },
                              "parameters": [
                                "__MatchMaking.DisableChangeScene",
                                "False"
                              ]
                            }
                          ],
                          "actions": [
                            {
                              "type": {
                                "value": "Wait"
                              },
                              "parameters": [
                                "1"
                              ]
                            },
                            {
                              "type": {
                                "value": "MatchMaking::ChangeScene"
                              },
                              "parameters": [
                                "",
                                "VariableString(__MatchMaking.ChangeScene.Host)",
                                ""
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "P2P::OnEvent"
                  },
                  "parameters": [
                    "\"__MatchMaking.connected\"",
                    ""
                  ]
                }
              ],
              "actions": [],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "Firebase::DatabaseDeleteField"
                      },
                      "parameters": [
                        "VariableString(__MatchMaking.FirebasePath)",
                        "Firebase::GetUserUID()",
                        "__MatchMaking.error"
                      ]
                    }
                  ],
                  "events": [
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [],
                      "actions": [
                        {
                          "type": {
                            "value": "ModVarScene"
                          },
                          "parameters": [
                            "__MatchMaking.LastPoll",
                            "=",
                            "Time(\"timestamp\")"
                          ]
                        },
                        {
                          "type": {
                            "value": "ModVarScene"
                          },
                          "parameters": [
                            "__MatchMaking.MatchMakingResult",
                            "=",
                            "3"
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "P2P::OnEvent"
                  },
                  "parameters": [
                    "\"__MatchMaking.waitingForHost\"",
                    ""
                  ]
                }
              ],
              "actions": [],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__MatchMaking.MatchMakingResult",
                        "=",
                        "4"
                      ]
                    }
                  ],
                  "events": [
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [
                        {
                          "type": {
                            "value": "SceneVariableAsBoolean"
                          },
                          "parameters": [
                            "__MatchMaking.DisableChangeScene",
                            "False"
                          ]
                        }
                      ],
                      "actions": [
                        {
                          "type": {
                            "value": "Wait"
                          },
                          "parameters": [
                            "1"
                          ]
                        },
                        {
                          "type": {
                            "value": "MatchMaking::ChangeScene"
                          },
                          "parameters": [
                            "",
                            "VariableString(__MatchMaking.ChangeScene.Client)",
                            ""
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "P2P::OnEvent"
                  },
                  "parameters": [
                    "\"__MatchMaking.restartRequest\"",
                    ""
                  ]
                }
              ],
              "actions": [],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__MatchMaking.MatchMakingResult",
                        "=",
                        "1"
                      ]
                    }
                  ],
                  "events": [
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [
                        {
                          "type": {
                            "value": "SceneVariableAsBoolean"
                          },
                          "parameters": [
                            "__MatchMaking.DisableChangeScene",
                            "False"
                          ]
                        }
                      ],
                      "actions": [
                        {
                          "type": {
                            "value": "Wait"
                          },
                          "parameters": [
                            "1"
                          ]
                        },
                        {
                          "type": {
                            "value": "MatchMaking::ChangeScene"
                          },
                          "parameters": [
                            "",
                            "CurrentSceneName()",
                            ""
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 109,
                "g": 230,
                "r": 255,
                "textB": 0,
                "textG": 0,
                "textR": 0
              },
              "comment": "Attempt to connect and restart after 5 retries",
              "comment2": ""
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "SceneVariableAsBoolean"
                  },
                  "parameters": [
                    "__MatchMaking.Connecting",
                    "True"
                  ]
                }
              ],
              "actions": [],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "BuiltinCommonInstructions::CompareNumbers"
                      },
                      "parameters": [
                        "mod(Time(\"sec\"),2)",
                        "=",
                        "0"
                      ]
                    },
                    {
                      "type": {
                        "value": "VarScene"
                      },
                      "parameters": [
                        "__MatchMaking.MatchMakingResult",
                        "<",
                        "3"
                      ]
                    },
                    {
                      "type": {
                        "value": "BuiltinCommonInstructions::Once"
                      },
                      "parameters": []
                    }
                  ],
                  "actions": [],
                  "events": [
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [
                        {
                          "type": {
                            "value": "VarScene"
                          },
                          "parameters": [
                            "__MatchMaking.Connection.attempts",
                            "=",
                            "0"
                          ]
                        }
                      ],
                      "actions": [],
                      "events": [
                        {
                          "type": "BuiltinCommonInstructions::Standard",
                          "conditions": [],
                          "actions": [
                            {
                              "type": {
                                "value": "Firebase::DatabaseDeleteField"
                              },
                              "parameters": [
                                "VariableString(__MatchMaking.FirebasePath)",
                                "Firebase::GetUserUID()",
                                "__MatchMaking.error"
                              ]
                            },
                            {
                              "type": {
                                "value": "ModVarScene"
                              },
                              "parameters": [
                                "__MatchMaking.MatchMakingResult",
                                "=",
                                "1"
                              ]
                            }
                          ],
                          "events": [
                            {
                              "type": "BuiltinCommonInstructions::Standard",
                              "conditions": [
                                {
                                  "type": {
                                    "value": "SceneVariableAsBoolean"
                                  },
                                  "parameters": [
                                    "__MatchMaking.DisableChangeScene",
                                    "False"
                                  ]
                                }
                              ],
                              "actions": [
                                {
                                  "type": {
                                    "value": "Wait"
                                  },
                                  "parameters": [
                                    "1"
                                  ]
                                },
                                {
                                  "type": {
                                    "value": "MatchMaking::ChangeScene"
                                  },
                                  "parameters": [
                                    "",
                                    "CurrentSceneName()",
                                    ""
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "folded": true,
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [
                        {
                          "type": {
                            "value": "VarScene"
                          },
                          "parameters": [
                            "__MatchMaking.Connection.attempts",
                            ">",
                            "0"
                          ]
                        }
                      ],
                      "actions": [
                        {
                          "type": {
                            "value": "ModVarScene"
                          },
                          "parameters": [
                            "__MatchMaking.Connection.attempts",
                            "-",
                            "1"
                          ]
                        }
                      ],
                      "events": [
                        {
                          "type": "BuiltinCommonInstructions::Standard",
                          "conditions": [],
                          "actions": [
                            {
                              "type": {
                                "value": "Firebase::DatabaseDeleteField"
                              },
                              "parameters": [
                                "VariableString(__MatchMaking.FirebasePath)",
                                "Firebase::GetUserUID()",
                                "__MatchMaking.error"
                              ]
                            },
                            {
                              "type": {
                                "value": "P2P::Connect"
                              },
                              "parameters": [
                                "VariableString(__MatchMaking.Connection.p2pId)"
                              ]
                            },
                            {
                              "type": {
                                "value": "ModVarGlobalTxt"
                              },
                              "parameters": [
                                "__MatchMaking.HostId",
                                "=",
                                "VariableString(__MatchMaking.Connection.p2pId)"
                              ]
                            }
                          ]
                        },
                        {
                          "type": "BuiltinCommonInstructions::Standard",
                          "conditions": [],
                          "actions": [
                            {
                              "type": {
                                "value": "ModVarSceneTxt"
                              },
                              "parameters": [
                                "__MatchMaking.error",
                                "=",
                                "\"Attempting connection: \" + VariableString(__MatchMaking.Connection.attempts)"
                              ]
                            },
                            {
                              "type": {
                                "value": "ModVarScene"
                              },
                              "parameters": [
                                "__MatchMaking.MatchMakingResult",
                                "=",
                                "2"
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "parameters": []
        },
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 109,
            "g": 230,
            "r": 255,
            "textB": 0,
            "textG": 0,
            "textR": 0
          },
          "comment": "If someone disconnected restart process all over again ",
          "comment2": ""
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "VarScene"
              },
              "parameters": [
                "__MatchMaking.MatchMakingResult",
                "=",
                "5"
              ]
            }
          ],
          "actions": [],
          "events": [
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 109,
                "g": 230,
                "r": 255,
                "textB": 0,
                "textG": 0,
                "textR": 0
              },
              "comment": "Send poll to clients every 6 seconds to let them know your online",
              "comment2": ""
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "BuiltinCommonInstructions::CompareNumbers"
                  },
                  "parameters": [
                    "mod(Time(\"sec\"),3)",
                    "=",
                    "0"
                  ]
                },
                {
                  "type": {
                    "value": "BuiltinCommonInstructions::Once"
                  },
                  "parameters": []
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "P2P::SendToAll"
                  },
                  "parameters": [
                    "\"__MatchMaking.onlinePoll\"",
                    "\"\""
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "P2P::OnDisconnection"
                  },
                  "parameters": []
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "P2P::SendToAll"
                  },
                  "parameters": [
                    "\"__MatchMaking.restartRequest\"",
                    "\"\""
                  ]
                },
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__MatchMaking.MatchMakingResult",
                    "=",
                    "1"
                  ]
                }
              ],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "SceneVariableAsBoolean"
                      },
                      "parameters": [
                        "__MatchMaking.DisableChangeScene",
                        "False"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "Wait"
                      },
                      "parameters": [
                        "1"
                      ]
                    },
                    {
                      "type": {
                        "value": "MatchMaking::ChangeScene"
                      },
                      "parameters": [
                        "",
                        "CurrentSceneName()",
                        ""
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Comment",
          "color": {
            "b": 109,
            "g": 230,
            "r": 255,
            "textB": 0,
            "textG": 0,
            "textR": 0
          },
          "comment": "There is no peer disconnect on the client side so were gonna make one up through polling",
          "comment2": ""
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "VarScene"
              },
              "parameters": [
                "__MatchMaking.MatchMakingResult",
                "=",
                "3"
              ]
            }
          ],
          "actions": [],
          "events": [
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "P2P::OnEvent"
                  },
                  "parameters": [
                    "\"__MatchMaking.onlinePoll\"",
                    ""
                  ]
                }
              ],
              "actions": [
                {
                  "type": {
                    "value": "ModVarScene"
                  },
                  "parameters": [
                    "__MatchMaking.LastPoll",
                    "=",
                    "Time(\"timestamp\")"
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 109,
                "g": 230,
                "r": 255,
                "textB": 0,
                "textG": 0,
                "textR": 0
              },
              "comment": "If host doesn't send a poll anymore consider it as a disconnection",
              "comment2": ""
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "BuiltinCommonInstructions::CompareNumbers"
                  },
                  "parameters": [
                    "(Time(\"timestamp\")-Variable(__MatchMaking.LastPoll))/1000",
                    ">=",
                    "6"
                  ]
                }
              ],
              "actions": [],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarScene"
                      },
                      "parameters": [
                        "__MatchMaking.MatchMakingResult",
                        "=",
                        "1"
                      ]
                    }
                  ],
                  "events": [
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [
                        {
                          "type": {
                            "value": "SceneVariableAsBoolean"
                          },
                          "parameters": [
                            "__MatchMaking.DisableChangeScene",
                            "False"
                          ]
                        }
                      ],
                      "actions": [
                        {
                          "type": {
                            "value": "Wait"
                          },
                          "parameters": [
                            "1"
                          ]
                        },
                        {
                          "type": {
                            "value": "MatchMaking::ChangeScene"
                          },
                          "parameters": [
                            "",
                            "CurrentSceneName()",
                            ""
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "MatchMaking Post Event Functions.",
      "fullName": "MatchMaking Post Event Functions",
      "functionType": "Action",
      "name": "MatchMakingPostEvents",
      "private": true,
      "sentence": "MatchMaking Post Event Functions",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "SceneVariableAsBoolean"
              },
              "parameters": [
                "__MatchMaking.ChangeScene.Enable",
                "True"
              ]
            }
          ],
          "actions": [
            {
              "type": {
                "value": "Scene"
              },
              "parameters": [
                "",
                "VariableString(__MatchMaking.ChangeScene.SceneToChange)",
                ""
              ]
            }
          ]
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Change Scene (Working).",
      "fullName": "Change Scene (Working)",
      "functionType": "Action",
      "name": "ChangeScene",
      "private": true,
      "sentence": "Change Scene _PARAM1_ (Working)",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "SetSceneVariableAsBoolean"
              },
              "parameters": [
                "__MatchMaking.ChangeScene.Enable",
                "True"
              ]
            },
            {
              "type": {
                "value": "ModVarSceneTxt"
              },
              "parameters": [
                "__MatchMaking.ChangeScene.SceneToChange",
                "=",
                "GetArgumentAsString(\"SceneName\")"
              ]
            }
          ]
        }
      ],
      "parameters": [
        {
          "description": "SceneName",
          "name": "SceneName",
          "type": "string"
        }
      ],
      "objectGroups": []
    },
    {
      "fullName": "",
      "functionType": "Action",
      "name": "onScenePostEvents",
      "sentence": "",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "MatchMaking::MatchMakingPostEvents"
              },
              "parameters": [
                "",
                ""
              ]
            }
          ]
        }
      ],
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Returns MatchMaking Result.",
      "fullName": "Returns MatchMaking Result",
      "functionType": "ExpressionAndCondition",
      "name": "MatchMakingResult",
      "sentence": "Returns MatchMaking Result",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "VarScene"
              },
              "parameters": [
                "__MatchMaking.MatchMakingResult",
                "=",
                "0"
              ]
            }
          ],
          "actions": [
            {
              "type": {
                "value": "SetReturnString"
              },
              "parameters": [
                "\"waiting\""
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "VarScene"
              },
              "parameters": [
                "__MatchMaking.MatchMakingResult",
                "=",
                "1"
              ]
            }
          ],
          "actions": [
            {
              "type": {
                "value": "SetReturnString"
              },
              "parameters": [
                "\"error\""
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "VarScene"
              },
              "parameters": [
                "__MatchMaking.MatchMakingResult",
                "=",
                "2"
              ]
            }
          ],
          "actions": [
            {
              "type": {
                "value": "SetReturnString"
              },
              "parameters": [
                "\"connecting\""
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "VarScene"
              },
              "parameters": [
                "__MatchMaking.MatchMakingResult",
                "=",
                "3"
              ]
            }
          ],
          "actions": [
            {
              "type": {
                "value": "SetReturnString"
              },
              "parameters": [
                "\"waiting for host\""
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "VarScene"
              },
              "parameters": [
                "__MatchMaking.MatchMakingResult",
                "=",
                "4"
              ]
            }
          ],
          "actions": [
            {
              "type": {
                "value": "SetReturnString"
              },
              "parameters": [
                "\"done\""
              ]
            }
          ]
        },
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [
            {
              "type": {
                "value": "VarScene"
              },
              "parameters": [
                "__MatchMaking.MatchMakingResult",
                "=",
                "5"
              ]
            }
          ],
          "actions": [
            {
              "type": {
                "value": "SetReturnString"
              },
              "parameters": [
                "\"waiting for clients\""
              ]
            }
          ]
        }
      ],
      "expressionType": {
        "type": "string"
      },
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Last timestamp recieved from peer in seconds, use this to check for any disconnections.",
      "fullName": "Last timestamp recieved from peer in seconds",
      "functionType": "ExpressionAndCondition",
      "name": "LastMessageRecievedTimeStamp",
      "sentence": "Last timestamp recieved from peer in seconds, use this to check for any disconnections",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "SetReturnNumber"
              },
              "parameters": [
                "(Time(\"timestamp\")-Variable(__MatchMaking._LastMessageRecievedTimeStamp))/1000"
              ]
            }
          ]
        }
      ],
      "expressionType": {
        "type": "expression"
      },
      "parameters": [],
      "objectGroups": []
    },
    {
      "description": "Number of messages recieved from peers.",
      "fullName": "Number of messages recieved from peers",
      "functionType": "ExpressionAndCondition",
      "name": "MessagesCount",
      "sentence": "Number of messages recieved from peers",
      "events": [
        {
          "type": "BuiltinCommonInstructions::Standard",
          "conditions": [],
          "actions": [
            {
              "type": {
                "value": "SetReturnNumber"
              },
              "parameters": [
                "Variable(__MatchMaking._MessageCount)"
              ]
            }
          ]
        }
      ],
      "expressionType": {
        "type": "expression"
      },
      "parameters": [],
      "objectGroups": []
    }
  ],
  "eventsBasedBehaviors": [
    {
      "description": "Sprite behavior that automatically send its position, angle and animations to the host.",
      "fullName": "Online Sprite Behavior",
      "name": "OnlineSprite",
      "objectType": "Sprite",
      "eventsFunctions": [
        {
          "description": "Set Online Sprite ID.",
          "fullName": "Set Online Sprite ID",
          "functionType": "Action",
          "name": "SetID",
          "sentence": "Set Online Sprite ID _PARAM0_ to _PARAM2_",
          "events": [
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "ModVarObjetTxt"
                  },
                  "parameters": [
                    "Object",
                    "__OnlineSprite.coordinates.id",
                    "=",
                    "GetArgumentAsString(\"ID\")"
                  ]
                }
              ]
            }
          ],
          "parameters": [
            {
              "description": "Object",
              "name": "Object",
              "supplementaryInformation": "Sprite",
              "type": "object"
            },
            {
              "description": "Behavior",
              "name": "Behavior",
              "supplementaryInformation": "MatchMaking::OnlineSprite",
              "type": "behavior"
            },
            {
              "description": "ID",
              "name": "ID",
              "type": "string"
            }
          ],
          "objectGroups": []
        },
        {
          "description": "Get ID.",
          "fullName": "Get ID",
          "functionType": "StringExpression",
          "name": "ID",
          "sentence": "",
          "events": [
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "SetReturnString"
                  },
                  "parameters": [
                    "Object.VariableString(__OnlineSprite.coordinates.id)"
                  ]
                }
              ]
            }
          ],
          "expressionType": {
            "type": "string"
          },
          "parameters": [
            {
              "description": "Object",
              "name": "Object",
              "supplementaryInformation": "Sprite",
              "type": "object"
            },
            {
              "description": "Behavior",
              "name": "Behavior",
              "supplementaryInformation": "MatchMaking::OnlineSprite",
              "type": "behavior"
            }
          ],
          "objectGroups": []
        },
        {
          "description": "Send Sprite Data.",
          "fullName": "Send Sprite Data",
          "functionType": "Action",
          "name": "SendData",
          "sentence": "Send Sprite _PARAM0_ Data",
          "events": [
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "ModVarObjet"
                  },
                  "parameters": [
                    "Object",
                    "__OnlineSprite.coordinates.x",
                    "=",
                    "Object.X()"
                  ]
                },
                {
                  "type": {
                    "value": "ModVarObjet"
                  },
                  "parameters": [
                    "Object",
                    "__OnlineSprite.coordinates.y",
                    "=",
                    "Object.Y()"
                  ]
                },
                {
                  "type": {
                    "value": "ModVarObjet"
                  },
                  "parameters": [
                    "Object",
                    "__OnlineSprite.coordinates.angle",
                    "=",
                    "Object.Angle()"
                  ]
                },
                {
                  "type": {
                    "value": "ModVarObjet"
                  },
                  "parameters": [
                    "Object",
                    "__OnlineSprite.coordinates.animation",
                    "=",
                    "Object.Animation()"
                  ]
                },
                {
                  "type": {
                    "value": "ModVarObjet"
                  },
                  "parameters": [
                    "Object",
                    "__OnlineSprite.coordinates.flip",
                    "=",
                    "0"
                  ]
                }
              ],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "FlippedX"
                      },
                      "parameters": [
                        "Object"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "ModVarObjet"
                      },
                      "parameters": [
                        "Object",
                        "__OnlineSprite.coordinates.flip",
                        "=",
                        "1"
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "MatchMaking::SendMessageToEveryone2"
                  },
                  "parameters": [
                    "",
                    "ObjectVarToJSON(Object, __OnlineSprite.coordinates)",
                    ""
                  ]
                }
              ]
            }
          ],
          "parameters": [
            {
              "description": "Object",
              "name": "Object",
              "supplementaryInformation": "Sprite",
              "type": "object"
            },
            {
              "description": "Behavior",
              "name": "Behavior",
              "supplementaryInformation": "MatchMaking::OnlineSprite",
              "type": "behavior"
            }
          ],
          "objectGroups": []
        },
        {
          "description": "Update Sprite Using Data.",
          "fullName": "Update Sprite Using Data",
          "functionType": "Action",
          "name": "UpdateSprite",
          "sentence": "Update Sprite _PARAM0_ Using Data _PARAM2_",
          "events": [
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [],
              "actions": [
                {
                  "type": {
                    "value": "JSONToVariableStructure"
                  },
                  "parameters": [
                    "GetArgumentAsString(\"JSONData\")",
                    "__OnlineSprite.coordinates"
                  ]
                }
              ],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [
                    {
                      "type": {
                        "value": "VarObjetTxt"
                      },
                      "parameters": [
                        "Object",
                        "__OnlineSprite.coordinates.id",
                        "=",
                        "VariableString(__OnlineSprite.coordinates.id)"
                      ]
                    },
                    {
                      "type": {
                        "value": "VarObjetTxt"
                      },
                      "parameters": [
                        "Object",
                        "__OnlineSprite.coordinates.id",
                        "!=",
                        "P2P::GetID()"
                      ]
                    }
                  ],
                  "actions": [
                    {
                      "type": {
                        "value": "MettreXY"
                      },
                      "parameters": [
                        "Object",
                        "=",
                        "Variable(__OnlineSprite.coordinates.x)",
                        "=",
                        "Variable(__OnlineSprite.coordinates.y)"
                      ]
                    },
                    {
                      "type": {
                        "value": "SetAngle"
                      },
                      "parameters": [
                        "Object",
                        "=",
                        "Variable(__OnlineSprite.coordinates.angle)"
                      ]
                    },
                    {
                      "type": {
                        "value": "ChangeAnimation"
                      },
                      "parameters": [
                        "Object",
                        "=",
                        "Variable(__OnlineSprite.coordinates.animation)"
                      ]
                    },
                    {
                      "type": {
                        "value": "FlipX"
                      },
                      "parameters": [
                        "Object",
                        "no"
                      ]
                    }
                  ],
                  "events": [
                    {
                      "type": "BuiltinCommonInstructions::Standard",
                      "conditions": [
                        {
                          "type": {
                            "value": "BuiltinCommonInstructions::CompareNumbers"
                          },
                          "parameters": [
                            "Variable(__OnlineSprite.coordinates.flip)",
                            "=",
                            "1"
                          ]
                        }
                      ],
                      "actions": [
                        {
                          "type": {
                            "value": "FlipX"
                          },
                          "parameters": [
                            "Object",
                            "yes"
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "parameters": [
            {
              "description": "Object",
              "name": "Object",
              "supplementaryInformation": "Sprite",
              "type": "object"
            },
            {
              "description": "Behavior",
              "name": "Behavior",
              "supplementaryInformation": "MatchMaking::OnlineSprite",
              "type": "behavior"
            },
            {
              "description": "JSONData",
              "name": "JSONData",
              "type": "string"
            }
          ],
          "objectGroups": []
        },
        {
          "fullName": "",
          "functionType": "Action",
          "name": "doStepPreEvents",
          "sentence": "",
          "events": [
            {
              "type": "BuiltinCommonInstructions::Comment",
              "color": {
                "b": 109,
                "g": 230,
                "r": 255,
                "textB": 0,
                "textG": 0,
                "textR": 0
              },
              "comment": "Send Position Data",
              "comment2": ""
            },
            {
              "type": "BuiltinCommonInstructions::Standard",
              "conditions": [
                {
                  "type": {
                    "value": "BuiltinCommonInstructions::CompareStrings"
                  },
                  "parameters": [
                    "Object.Behavior::ID()",
                    "=",
                    "P2P::GetID()"
                  ]
                }
              ],
              "actions": [],
              "events": [
                {
                  "type": "BuiltinCommonInstructions::Standard",
                  "conditions": [],
                  "actions": [
                    {
                      "type": {
                        "value": "MatchMaking::OnlineSprite::SendData"
                      },
                      "parameters": [
                        "Object",
                        "Behavior",
                        ""
                      ]
                    }
                  ]
                }
              ]
            }
          ],
          "parameters": [
            {
              "description": "Object",
              "name": "Object",
              "supplementaryInformation": "Sprite",
              "type": "object"
            },
            {
              "description": "Behavior",
              "name": "Behavior",
              "supplementaryInformation": "MatchMaking::OnlineSprite",
              "type": "behavior"
            }
          ],
          "objectGroups": []
        }
      ],
      "propertyDescriptors": [],
      "sharedPropertyDescriptors": []
    }
  ],
  "eventsBasedObjects": []
}